{% extends "webclient/data/containers.html" %}
{% load i18n %}

{% comment %}
<!--
  Copyright (C) 2016 University of Dundee & Open Microscopy Environment.
  All rights reserved.

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.

  Author: Aleksandra Tarkowska <A(dot)Tarkowska(at)dundee(dot)ac(dot)uk>,

  Version: 1.0
-->
{% endcomment %}

{% block link %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static "mapannotations/css/jquery.autocomplete-1.2.24.css" %}" type="text/css" />
    <link rel="stylesheet" href="{% static "mapannotations/css/mapannotations.css" %}" type="text/css" />
{% endblock %}

{% block script %}
    {{ block.super }}

    <script type="text/javascript">
        WEBCLIENT.URLS.api_paths_to_object = "{% url 'mapannotations_api_paths_to_object' %}";

        WEBCLIENT.URLS.api_tags_and_tagged = "{% url 'mapannotations_api_mapannotations' %}";
        WEBCLIENT.URLS.tree_top_level = WEBCLIENT.URLS.api_tags_and_tagged;
        WEBCLIENT.URLS.api_plates = "{% url 'mapannotations_api_plates' %}";
        WEBCLIENT.URLS.api_plate_acquisitions = "{% url 'mapannotations_api_images' %}";

        {% if active_user %}
        WEBCLIENT.active_user = {'id': {{ active_user.id }} };
        WEBCLIENT.URLS.api_experimenter = "{% url 'mapannotations_api_experimenter' active_user.id %}";
        {% else %}
        WEBCLIENT.URLS.api_experimenter = "{% url 'mapannotations_api_experimenter' -1 %}";
        {% endif %}

        var MAPANNOTATIONS = {}
        MAPANNOTATIONS.URLS = {'static_webclient': "{% static 'mapannotations' %}/"};

    </script>

    <script src="{% static 'mapannotations/javascript/mapannotations.tree.js'|add:url_suffix %}"></script>

    <script src="{% static 'mapannotations/javascript/jquery.autocomplete-1.2.24.js'%}"></script>

    <script type="text/javascript">

        $(function () {
            var oldData = $.jstree.reference('#dataTree').settings.core.data;
            var inst = $.jstree.reference('#dataTree');
            $('#autocomplete').devbridgeAutocomplete({
                serviceUrl: '{% url 'mapannotations_autocomplete' %}',
                params: {
                    "experimenter_id": {% if active_user %}{{ active_user.id }}{% else %}-1{% endif %} ,
                    "group": {{ active_group.id }}
                },
                onSelect: function (suggestion) {
                    $.jstree.reference('#dataTree').settings.core.data = function(node, callback, payload) {
                        oldData.apply(inst, [node, callback, {'query': suggestion.value}]);
                    };
                    $.jstree.reference('#dataTree').refresh();
                }
            });

        });
    </script>
{% endblock %}


{% block left %}

    <div id="left_panel_tabs" class="absolute_fill ui-tabs">

        <!-- toolbar above tree -->
        <div>

            <!-- Show Tags toolbar for tag page... -->
            <ul class="toolbar">

                <li><input id="refreshButton" class="button" type="image" src="{% static "webclient/image/icon_toolbar_refresh.png" %}" alt="Refresh" title="Refresh" /></li>

                <li class="seperator"></li>

                <li><input type="text" name="mapannotation" id="autocomplete"/></li>

            </ul>

            <div class="clear"></div>

            <div id="tree_details" class="left_panel_inner">
                <div class="dataTree" id="dataTree"></div>
            </div>
        </div>

    </div>
{% endblock %}
